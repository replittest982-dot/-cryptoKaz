<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Crypto Live</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body { margin: 0; background: #0f1923; color: white; font-family: sans-serif; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        
        /* –ö–ê–ù–í–ê–° */
        .game-area { position: relative; flex-grow: 1; background: radial-gradient(circle at bottom, #1c252e, #000000); }
        canvas { width: 100%; height: 100%; display: block; }
        
        /* –¢–ï–ö–°–¢ –ü–û –¶–ï–ù–¢–†–£ */
        .hud { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); text-align: center; pointer-events: none; }
        .multiplier { font-size: 64px; font-weight: 900; color: white; text-shadow: 0 0 20px #00ff88; }
        .status { font-size: 18px; color: #888; margin-top: 5px; }

        /* –ö–ù–û–ü–ö–ò */
        .controls { padding: 20px; background: #151e27; border-top: 1px solid #333; }
        .btn { width: 100%; padding: 18px; border-radius: 14px; border: none; font-size: 20px; font-weight: bold; cursor: pointer; color: white; transition: 0.1s; }
        .btn-bet { background: #3b82f6; box-shadow: 0 4px 0 #2563eb; }
        .btn-cashout { background: #10b981; box-shadow: 0 4px 0 #059669; }
        .btn-wait { background: #374151; color: #9ca3af; pointer-events: none; }
    </style>
</head>
<body>

    <div class="game-area">
        <canvas id="canvas"></canvas>
        <div class="hud">
            <div id="mText" class="multiplier">1.00x</div>
            <div id="sText" class="status">Connecting...</div>
        </div>
    </div>

    <div class="controls">
        <button id="mainBtn" class="btn btn-wait">–ó–ê–ì–†–£–ó–ö–ê...</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // ‚úÖ –¢–í–û–ô –ù–û–í–´–ô –†–ê–ë–û–ß–ò–ô –î–û–ú–ï–ù (–ë–ï–ó "/" –í –ö–û–ù–¶–ï)
        const SERVER_URL = "https://bot_1766306473_1270_metropabg189-gmail-c.bothost.ru";

        // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è
        const socket = io(SERVER_URL, { transports: ['websocket', 'polling'] });

        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const elM = document.getElementById('mText');
        const elS = document.getElementById('sText');
        const elBtn = document.getElementById('mainBtn');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let W, H;

        // === –°–û–ë–´–¢–ò–Ø –°–ï–†–í–ï–†–ê ===
        
        socket.on('connect', () => {
            elS.innerText = "üü¢ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ!";
        });

        socket.on('disconnect', () => {
            elS.innerText = "üî¥ –ü–æ—Ç–µ—Ä—è —Å–≤—è–∑–∏";
        });

        socket.on('state', (state) => {
            if(state.status === "WAITING") {
                resetView();
            }
        });

        socket.on('tick', (m) => {
            elM.innerText = m.toFixed(2) + "x";
            elS.innerText = "–†–∞–∫–µ—Ç–∞ –ª–µ—Ç–∏—Ç!";
            elBtn.className = "btn btn-cashout";
            elBtn.innerText = "–ó–ê–ë–†–ê–¢–¨";
            draw(m);
        });

        socket.on('crash', (data) => {
            elM.innerText = "CRASH " + data.m.toFixed(2) + "x";
            elM.style.color = "#ef4444";
            elS.innerText = "–í–∑—Ä—ã–≤!";
            elBtn.className = "btn btn-wait";
            elBtn.innerText = "–í–ó–û–†–í–ê–õ–°–Ø";
            tg.HapticFeedback.notificationOccurred('error');
        });

        function resetView() {
            elM.innerText = "1.00x";
            elM.style.color = "white";
            elS.innerText = "–û–∂–∏–¥–∞–Ω–∏–µ —Å—Ç–∞–≤–æ–∫...";
            elBtn.className = "btn btn-bet";
            elBtn.innerText = "–°–¢–ê–í–ö–ê";
            
            // –û—á–∏—â–∞–µ–º —Ä–∏—Å—É–Ω–æ–∫
            ctx.clearRect(0,0, W, H);
        }

        // === –ì–†–ê–§–ò–ö–ê (–ö–†–ê–°–ò–í–ê–Ø –ö–†–ò–í–ê–Ø) ===
        function resize() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            W = canvas.width; H = canvas.height;
        }
        window.addEventListener('resize', resize);
        resize();

        function draw(m) {
            ctx.clearRect(0,0, W, H);

            // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é
            let progress = (m - 1) / 5; // –ú–∞—Å—à—Ç–∞–± (–¥–æ 6x —Ä–∞–∫–µ—Ç–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ)
            if(progress > 0.9) progress = 0.9;
            
            let x = 40 + (W - 80) * progress;
            let y = (H - 40) - (H - 80) * progress;

            // 1. –†–∏—Å—É–µ–º —Å–ª–µ–¥ (–Ω–µ–æ–Ω–æ–≤–∞—è –ª–∏–Ω–∏—è)
            ctx.beginPath();
            ctx.moveTo(40, H-40);
            ctx.quadraticCurveTo(x, H-40, x, y); // –ò–∑–æ–≥–Ω—É—Ç–∞—è –ª–∏–Ω–∏—è
            ctx.strokeStyle = "#a855f7"; // –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –Ω–µ–æ–Ω
            ctx.lineWidth = 6;
            ctx.lineCap = "round";
            ctx.stroke();
            
            // –°–≤–µ—á–µ–Ω–∏–µ –ª–∏–Ω–∏–∏
            ctx.shadowBlur = 15;
            ctx.shadowColor = "#a855f7";
            ctx.stroke();
            ctx.shadowBlur = 0;

            // 2. –†–∏—Å—É–µ–º –†–∞–∫–µ—Ç—É (—Ç–µ–∫—Å—Ç)
            ctx.save();
            ctx.translate(x, y);
            ctx.font = "40px Arial";
            ctx.shadowColor = "white";
            ctx.shadowBlur = 10;
            ctx.fillText("üöÄ", -20, 10);
            ctx.restore();
        }
    </script>
</body>
</html>
