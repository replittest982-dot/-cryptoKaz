<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EasyWin</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #09090b; --card: #18181b; --gold: #eab308; --text: #fff; --green: #22c55e; --red: #ef4444; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Montserrat', sans-serif; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

        /* HEADER */
        .header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; background: #000; border-bottom: 1px solid #222; }
        .logo { font-weight: 900; font-size: 20px; font-style: italic; }
        .logo span { color: var(--gold); }
        .balance { background: #222; padding: 6px 12px; border-radius: 12px; font-weight: 700; color: var(--gold); border: 1px solid #333; }

        /* SCREENS */
        .screen { display: none; flex: 1; flex-direction: column; padding: 20px; overflow-y: auto; }
        .screen.active { display: flex; }

        /* GAMES GRID */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .game-card { background: var(--card); border: 1px solid #27272a; border-radius: 16px; padding: 20px; display: flex; flex-direction: column; align-items: center; gap: 10px; cursor: pointer; transition: 0.1s; }
        .game-card:active { transform: scale(0.96); background: #222; }
        .g-icon { font-size: 40px; }
        .g-name { font-weight: 700; font-size: 14px; }

        /* GAME UI */
        .game-area { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .result-display { font-size: 100px; transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .result-text { font-size: 18px; font-weight: 800; margin-top: 20px; height: 24px; }
        .win { color: var(--green); } .lose { color: var(--red); }

        /* CONTROLS */
        .controls { background: var(--card); padding: 20px; border-radius: 20px 20px 0 0; border-top: 1px solid #222; }
        
        .modes-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 15px; margin-bottom: 10px; }
        .mode-btn { padding: 10px 15px; background: #27272a; border-radius: 10px; font-size: 12px; font-weight: 700; color: #aaa; white-space: nowrap; border: 1px solid transparent; cursor: pointer; }
        .mode-btn.selected { background: rgba(234, 179, 8, 0.15); color: var(--gold); border-color: var(--gold); }

        .bet-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .input-box { flex: 1; background: #000; border: 1px solid #333; border-radius: 12px; display: flex; align-items: center; padding: 0 15px; }
        input { width: 100%; background: none; border: none; color: white; font-size: 18px; font-weight: 700; padding: 12px 0; text-align: center; }
        
        .play-btn { width: 100%; height: 55px; background: var(--gold); border: none; border-radius: 14px; font-size: 18px; font-weight: 900; color: #000; cursor: pointer; }
        .play-btn:disabled { background: #333; color: #555; }
        .play-btn:active { transform: translateY(2px); }

        .back-btn { position: absolute; top: 0; left: 0; padding: 10px; color: #666; font-weight: 700; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo">Easy<span>Win</span></div>
        <div class="balance">üíé <span id="bal">...</span></div>
    </div>

    <div id="hub" class="screen active">
        <h2 style="margin-top:0">–ò–≥—Ä—ã</h2>
        <div class="grid">
            <div class="game-card" onclick="openGame('cube')">
                <div class="g-icon">üé≤</div>
                <div class="g-name">–ö—É–±</div>
            </div>
            <div class="game-card" onclick="openGame('football')">
                <div class="g-icon">‚öΩ</div>
                <div class="g-name">–§—É—Ç–±–æ–ª</div>
            </div>
            <div class="game-card" onclick="openGame('basket')">
                <div class="g-icon">üèÄ</div>
                <div class="g-name">–ë–∞—Å–∫–µ—Ç</div>
            </div>
            <div class="game-card" onclick="openGame('darts')">
                <div class="g-icon">üéØ</div>
                <div class="g-name">–î–∞—Ä—Ç—Å</div>
            </div>
            <div class="game-card" onclick="openGame('bowling')">
                <div class="g-icon">üé≥</div>
                <div class="g-name">–ë–æ—É–ª–∏–Ω–≥</div>
            </div>
        </div>
    </div>

    <div id="game-room" class="screen">
        <div class="back-btn" onclick="toHub()">‚Üê –ù–∞–∑–∞–¥</div>
        
        <div class="game-area">
            <div id="display" class="result-display">üé≤</div>
            <div id="res-text" class="result-text"></div>
        </div>

        <div class="controls">
            <div class="modes-scroll" id="modes-list"></div>

            <div class="bet-row">
                <div class="input-box">
                    <input type="number" id="bet" value="10" step="1">
                </div>
            </div>
            <button class="play-btn" id="btn-play" onclick="play()">–ò–ì–†–ê–¢–¨</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // –í–ê–ñ–ù–û: –¢–≤–æ–π URL
        const SERVER_URL = "https://bot_1766306473_1270_metropabg189-gmail-c.bothost.ru";
        const socket = io(SERVER_URL, { transports: ['polling', 'websocket'] });

        let curGame = null;
        let curMode = null;
        let userBal = 0;
        let isPlaying = false;

        // --- GAME CONFIGS ---
        const GAMES = {
            'cube': {
                icon: 'üé≤',
                modes: [
                    {id: 'over_4', name: '–ë–æ–ª—å—à–µ 4 (x2.8)'},
                    {id: 'under_4', name: '–ú–µ–Ω—å—à–µ 4 (x1.4)'},
                    {id: 'even', name: '–ß–µ—Ç (x1.9)'},
                    {id: 'odd', name: '–ù–µ—á–µ—Ç (x1.9)'},
                    {id: 'over_5', name: '–ë–æ–ª—å—à–µ 5 (x5.5)'},
                    {id: 'under_2', name: '–ú–µ–Ω—å—à–µ 2 (x5.5)'}
                ]
            },
            'football': {
                icon: '‚öΩ',
                modes: [
                    {id: 'goal', name: '–ì–æ–ª (x1.6)'},
                    {id: 'miss', name: '–ú–∏–º–æ (x2.3)'}
                ]
            },
            'basket': {
                icon: 'üèÄ',
                modes: [
                    {id: 'goal', name: '–ü–æ–ø–∞–ª (x2.3)'},
                    {id: 'miss', name: '–ú–∏–º–æ (x1.5)'}
                ]
            },
            'darts': {
                icon: 'üéØ',
                modes: [
                    {id: 'center', name: '–¶–µ–Ω—Ç—Ä (x5.5)'},
                    {id: 'color', name: '–¶–≤–µ—Ç (x1.4)'},
                    {id: 'miss', name: '–ú–∏–º–æ (x5.5)'}
                ]
            },
            'bowling': {
                icon: 'üé≥',
                modes: [
                    {id: 'strike', name: '–°—Ç—Ä–∞–π–∫ (x5.5)'},
                    {id: 'miss', name: '–ù–µ —Å—Ç—Ä–∞–π–∫ (x1.15)'}
                ]
            }
        };

        // --- SOCKET ---
        socket.on('connect', () => {
            const uid = new URLSearchParams(window.location.search).get('user_id');
            socket.emit('auth', { user_id: uid });
        });

        socket.on('balance', b => {
            userBal = b;
            document.getElementById('bal').innerText = b.toFixed(1);
        });

        socket.on('game_result', res => {
            isPlaying = false;
            document.getElementById('btn-play').disabled = false;
            document.getElementById('btn-play').innerText = "–ò–ì–†–ê–¢–¨";

            // –ê–Ω–∏–º–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            const disp = document.getElementById('display');
            const txt = document.getElementById('res-text');
            
            // –ï—Å–ª–∏ –∫—É–±–∏–∫/—Ñ—É—Ç–±–æ–ª, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
            // –î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≠–º–æ–¥–∑–∏ –∏–≥—Ä—ã
            // –ú–æ–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–∞–¥—Ä—ã, –Ω–æ –ø–æ–∫–∞ —Ç–∞–∫:
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç (WIN/LOSE)
            if(res.win) {
                tg.HapticFeedback.notificationOccurred('success');
                txt.innerText = `WIN (+${res.win_amt.toFixed(1)})`;
                txt.className = "result-text win";
                disp.style.transform = "scale(1.5)";
            } else {
                tg.HapticFeedback.notificationOccurred('error');
                txt.innerText = "LOSE";
                txt.className = "result-text lose";
                disp.style.transform = "scale(0.8)";
            }
            
            setTimeout(() => { disp.style.transform = "scale(1)"; }, 300);
            
            userBal = res.balance;
            document.getElementById('bal').innerText = userBal.toFixed(1);
        });

        // --- UI FUNCS ---
        function openGame(key) {
            curGame = key;
            const conf = GAMES[key];
            
            // Setup Screen
            document.getElementById('display').innerText = conf.icon;
            document.getElementById('res-text').innerText = "";
            document.getElementById('hub').classList.remove('active');
            document.getElementById('game-room').classList.add('active');

            // Setup Modes
            const list = document.getElementById('modes-list');
            list.innerHTML = "";
            conf.modes.forEach((m, idx) => {
                const btn = document.createElement('div');
                btn.className = "mode-btn";
                btn.innerText = m.name;
                btn.onclick = () => selectMode(m.id, btn);
                if (idx === 0) selectMode(m.id, btn); // Auto select first
                list.appendChild(btn);
            });
        }

        function selectMode(id, btn) {
            curMode = id;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('selected'));
            if(btn) btn.classList.add('selected');
        }

        function toHub() {
            document.getElementById('game-room').classList.remove('active');
            document.getElementById('hub').classList.add('active');
        }

        function play() {
            if(isPlaying) return;
            
            const bet = parseFloat(document.getElementById('bet').value);
            if(bet <= 0 || bet > userBal) {
                tg.HapticFeedback.notificationOccurred('warning');
                return;
            }

            isPlaying = true;
            document.getElementById('btn-play').disabled = true;
            document.getElementById('btn-play').innerText = "ROLLING...";
            document.getElementById('res-text').innerText = "";
            
            // –ê–Ω–∏–º–∞—Ü–∏—è "—Ç—Ä—è—Å–∫–∏"
            const disp = document.getElementById('display');
            disp.style.transform = "rotate(10deg)";
            setTimeout(() => disp.style.transform = "rotate(-10deg)", 100);
            setTimeout(() => disp.style.transform = "rotate(0deg)", 200);

            // –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            socket.emit('play', {
                game: curGame,
                mode: curMode,
                bet: bet
            });
        }

    </script>
</body>
</html>
