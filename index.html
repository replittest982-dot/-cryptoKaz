<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rocket Crash Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background-color: #0f1923;
            color: white;
            font-family: 'Roboto', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .header {
            width: 100%;
            padding: 15px;
            background: #1c252e;
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            box-sizing: border-box;
        }
        .balance { color: #2ecc71; font-size: 18px; }
        
        /* –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ */
        .game-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            position: relative;
        }
        
        .rocket-container {
            font-size: 80px;
            transition: transform 0.1s;
        }
        
        .multiplier {
            font-size: 60px;
            font-weight: 900;
            margin-top: 20px;
            color: white;
        }
        
        .status-text {
            color: #aaa;
            margin-bottom: 20px;
            font-size: 18px;
        }

        /* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .controls {
            width: 90%;
            background: #1c252e;
            padding: 20px;
            border-radius: 20px 20px 0 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .bet-input-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #0f1923;
            padding: 10px;
            border-radius: 10px;
        }

        input {
            background: transparent;
            border: none;
            color: white;
            font-size: 20px;
            width: 100px;
            text-align: center;
        }

        .btn {
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: 0.2s;
        }

        .btn-play { background: #3498db; color: white; }
        .btn-cashout { background: #e67e22; color: white; display: none; }
        .btn-disabled { background: #555; color: #888; pointer-events: none; }

        .history {
            height: 30px;
            display: flex;
            gap: 10px;
            overflow-x: auto;
            width: 90%;
            margin-bottom: 10px;
        }
        .badge {
            background: #333;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
        }
        .crash-red { color: #e74c3c; }
    </style>
</head>
<body>

    <div class="header">
        <span>–†–∞–∫–µ—Ç–∫–∞ üöÄ</span>
        <span class="balance" id="balance">üí∞ 1000</span>
    </div>

    <div class="history" id="history">
        </div>

    <div class="game-area">
        <div class="rocket-container" id="rocket">üöÄ</div>
        <div class="multiplier" id="display">0.00x</div>
        <div class="status-text" id="status">–ñ–¥—É —Å—Ç–∞–≤–∫—É...</div>
    </div>

    <div class="controls">
        <div class="bet-input-group">
            <button onclick="changeBet(-50)" style="background:none; border:none; color:white;">‚ûñ</button>
            <input type="number" id="betAmount" value="100" readonly>
            <button onclick="changeBet(50)" style="background:none; border:none; color:white;">‚ûï</button>
        </div>

        <button id="mainBtn" class="btn btn-play" onclick="startGame()">–°–¢–ê–í–ö–ê</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã
        let balance = 1000;
        let currentBet = 100;
        let multiplier = 1.00;
        let isFlying = false;
        let crashPoint = 0;
        let timerInterval;
        let flyInterval;
        let countdown = 5;

        // –≠–ª–µ–º–µ–Ω—Ç—ã UI
        const elBalance = document.getElementById('balance');
        const elDisplay = document.getElementById('display');
        const elRocket = document.getElementById('rocket');
        const elStatus = document.getElementById('status');
        const btn = document.getElementById('mainBtn');
        const elBet = document.getElementById('betAmount');
        const elHistory = document.getElementById('history');

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
        function updateBalance() {
            elBalance.innerText = `üí∞ ${Math.floor(balance)}`;
        }

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏
        function changeBet(amount) {
            if (isFlying) return;
            let newBet = currentBet + amount;
            if (newBet >= 50 && newBet <= balance) {
                currentBet = newBet;
                elBet.value = currentBet;
            }
        }

        // 1. –ù–ê–ß–ê–õ–û: –¢–∞–π–º–µ—Ä 5 —Å–µ–∫—É–Ω–¥
        function startGame() {
            if (balance < currentBet) {
                tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!");
                return;
            }

            // –°–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É
            balance -= currentBet;
            updateBalance();

            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            btn.className = 'btn btn-disabled';
            btn.innerText = '–û–ñ–ò–î–ê–ù–ò–ï...';
            
            // –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
            countdown = 5;
            elStatus.innerText = `–í–∑–ª–µ—Ç —á–µ—Ä–µ–∑ ${countdown} —Å–µ–∫...`;
            
            timerInterval = setInterval(() => {
                countdown--;
                elStatus.innerText = `–í–∑–ª–µ—Ç —á–µ—Ä–µ–∑ ${countdown} —Å–µ–∫...`;
                
                if (countdown <= 0) {
                    clearInterval(timerInterval);
                    startFlight();
                }
            }, 1000);
        }

        // 2. –ü–û–õ–ï–¢
        function startFlight() {
            isFlying = true;
            multiplier = 1.00;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–æ–≥–¥–∞ —Ä–∞–∫–µ—Ç–∞ —É–ø–∞–¥–µ—Ç (—Å–ª—É—á–∞–π–Ω–æ –æ—Ç 1.00 –¥–æ 5.00)
            // –®–∞–Ω—Å –∫—Ä–∞—à–∞ —Å—Ä–∞–∑—É (1.00) —Ç–æ–∂–µ –µ—Å—Ç—å!
            crashPoint = (Math.random() * 4 + 1).toFixed(2); 
            if (Math.random() < 0.3) crashPoint = (Math.random() * 1.5 + 1).toFixed(2); // 30% —à–∞–Ω—Å –Ω–∏–∑–∫–æ–≥–æ –∫—Ä–∞—à–∞

            elStatus.innerText = "–†–ê–ö–ï–¢–ê –õ–ï–¢–ò–¢!";
            elRocket.style.transform = "translate(5px, -5px)"; // –õ–µ–≥–∫–∞—è –∞–Ω–∏–º–∞—Ü–∏—è

            // –ú–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ "–ó–ê–ë–†–ê–¢–¨"
            btn.className = 'btn btn-cashout';
            btn.innerText = `–ó–ê–ë–†–ê–¢–¨ ${(currentBet * 1.0).toFixed(0)}`;
            btn.onclick = cashOut;

            // –¶–∏–∫–ª –ø–æ–ª–µ—Ç–∞ (–±—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∏—Å–µ–ª)
            flyInterval = setInterval(() => {
                multiplier += 0.01;
                elDisplay.innerText = multiplier.toFixed(2) + 'x';
                btn.innerText = `–ó–ê–ë–†–ê–¢–¨ ${(currentBet * multiplier).toFixed(0)}`;

                // –ê–Ω–∏–º–∞—Ü–∏—è —Ç—Ä—è—Å–∫–∏ —Ä–∞–∫–µ—Ç—ã
                elRocket.style.transform = `translate(${Math.random()*2}px, -${Math.random()*2}px) scale(1.1)`;

                // –ü–†–û–í–ï–†–ö–ê –ù–ê –ö–†–ê–®
                if (multiplier >= crashPoint) {
                    crash();
                }
            }, 50); // –°–∫–æ—Ä–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—á–µ–º –º–µ–Ω—å—à–µ —á–∏—Å–ª–æ, —Ç–µ–º –±—ã—Å—Ç—Ä–µ–µ –ª–µ—Ç–∏—Ç)
        }

        // 3. –ó–ê–ë–†–ê–¢–¨ –î–ï–ù–¨–ì–ò
        function cashOut() {
            if (!isFlying) return;
            clearInterval(flyInterval);
            isFlying = false;

            let winAmount = Math.floor(currentBet * multiplier);
            balance += winAmount;
            updateBalance();

            elStatus.innerText = `–í–´–ò–ì–†–´–®: +${winAmount}`;
            elStatus.style.color = '#2ecc71';
            elDisplay.style.color = '#2ecc71';
            
            tg.HapticFeedback.notificationOccurred('success'); // –í–∏–±—Ä–∞—Ü–∏—è
            
            endRound(multiplier.toFixed(2));
        }

        // 4. –í–ó–†–´–í (–ü—Ä–æ–∏–≥—Ä—ã—à)
        function crash() {
            clearInterval(flyInterval);
            isFlying = false;
            
            elRocket.innerText = "üí•"; // –ú–µ–Ω—è–µ–º —Ä–∞–∫–µ—Ç—É –Ω–∞ –≤–∑—Ä—ã–≤
            elDisplay.style.color = "#e74c3c";
            elStatus.innerText = "–†–ê–ö–ï–¢–ê –†–ê–ó–ë–ò–õ–ê–°–¨!";
            elStatus.style.color = "#e74c3c";
            
            tg.HapticFeedback.notificationOccurred('error'); // –í–∏–±—Ä–∞—Ü–∏—è –æ—à–∏–±–∫–∏

            endRound(crashPoint);
        }

        // –°–±—Ä–æ—Å —Ä–∞—É–Ω–¥–∞
        function endRound(finalMulti) {
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
            let badge = document.createElement('span');
            badge.className = 'badge';
            badge.innerText = finalMulti + 'x';
            if(finalMulti < 1.5) badge.classList.add('crash-red');
            elHistory.prepend(badge);

            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É
            setTimeout(() => {
                elRocket.innerText = "üöÄ";
                elRocket.style.transform = "none";
                elDisplay.innerText = "0.00x";
                elDisplay.style.color = "white";
                elStatus.innerText = "–ñ–¥—É —Å—Ç–∞–≤–∫—É...";
                elStatus.style.color = "#aaa";

                btn.className = 'btn btn-play';
                btn.innerText = '–°–¢–ê–í–ö–ê';
                btn.onclick = startGame;
            }, 3000); // –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –º–æ–∂–Ω–æ —Å–Ω–æ–≤–∞ –∏–≥—Ä–∞—Ç—å
        }
    </script>
</body>
</html>
